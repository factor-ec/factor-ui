{"version":3,"file":"factor-common.js.map","sources":["ng://factor-common/lib/storage.service.ts","ng://factor-common/lib/auth.service.ts","ng://factor-common/lib/auth-interceptor.ts","ng://factor-common/lib/common.module.ts","ng://factor-common/lib/google-analytics.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class StorageService {\n\n  constructor() { }\n\n  delete(key: string, storage?) {\n    if (storage) {\n      delete storage[key];\n    }else{\n      delete sessionStorage[key];\n    }\n  }\n  get(key: string, storage?) {\n    let parsedValue;\n    let value = storage ? storage[key] : sessionStorage[key];\n    if (value) {\n      try {\n        parsedValue = JSON.parse(value);\n      } catch (err) {\n        parsedValue = value;\n      }\n    }\n    return parsedValue;\n  }\n  set(key: string, value: any, storage?) {\n    if (storage) {\n      storage[key] = JSON.stringify(value);\n    } else {\n      sessionStorage[key] = JSON.stringify(value);\n    }\n  }\n}\n","import { Injectable, Injector, Inject } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { Router } from '@angular/router';\nimport { BehaviorSubject, Observable } from \"rxjs\";\nimport { tap } from 'rxjs/operators';\n\nimport { StorageService } from './storage.service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class AuthService {\n  private loggedInSource: BehaviorSubject<boolean> = new BehaviorSubject<boolean>(false);\n  loggedIn$: Observable<boolean> = this.loggedInSource.asObservable();\n  private configurationSource: BehaviorSubject<any> = new BehaviorSubject<any>(false);\n  configuration$: Observable<any> = this.configurationSource.asObservable();\n  router: Router;\n\n  constructor(\n    private http: HttpClient,\n    private injector: Injector,\n    private storageService: StorageService,\n    @Inject('environment') private environment\n  ) { }\n\n  login(formValue: { username: string, password: string }) {\n    let body: object = Object.assign(formValue, {\n      grant_type: 'password',\n      response_type: 'token',\n      client_id: this.environment.oauth.clientId,\n      client_secret: this.environment.oauth.clientSecret\n    });\n    return this.http.post(this.environment.oauth.tokenUrl, body).pipe(tap((token: any) => {\n      this.storageService.set('token', token);\n    }));\n  }\n  logout(redirect?: string) {\n    this.router = this.injector.get(Router);\n    this.storageService.delete('token');\n    this.loggedInSource.next(false);\n    this.router.navigate(['/login', redirect? {redirect:redirect} : {}]);\n  }\n  getConfiguration() {\n    return this.http.get(this.environment.configurationUrl).pipe(tap((response: any) => {\n      this.loggedInSource.next(true);\n      this.configurationSource.next(response);\n      //Save last user loggedIn\n      this.storageService.set('lastUser', {\n        username: response.user.username,\n        picture: response.picture\n      }, localStorage);\n    }));\n  }\n  getToken() {\n    return this.storageService.get('token');\n  }\n  checkAuth() {\n    if (this.getToken()) {\n      let config = this.getConfiguration().subscribe(()=>{\n        this.loggedInSource.next(true);\n      }, (error)=>{\n        if (error.status == 0) {\n          this.router = this.injector.get(Router);\n          this.router.navigateByUrl('/error/0', { skipLocationChange: true });\n        }\n      });\n      return config;\n    }else{\n      return false;\n    }\n  }\n}\n","import { Injectable, Injector } from '@angular/core';\nimport { HttpEvent, HttpInterceptor, HttpHandler, HttpRequest, HttpErrorResponse } from '@angular/common/http';\nimport { Observable } from \"rxjs\";\nimport { tap } from 'rxjs/operators';\n\nimport { AuthService } from './auth.service';\n\n@Injectable()\nexport class AuthInterceptor {\n  private authService: AuthService;\n\n  constructor(\n    private injector: Injector\n  ) { }\n\n  intercept(request: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>> {\n    this.authService = this.injector.get(AuthService);\n    let token = this.authService.getToken();\n    if (token) {\n      request = request.clone({\n        headers: request.headers.set('Authorization', `${token.token_type} ${token.access_token}`)\n      });\n    }\n    return next.handle(request).pipe(\n      tap(event => { }, err => {\n        if (err instanceof HttpErrorResponse) {\n          if (err.status == 401) {\n            this.authService.logout();\n          }\n        }\n      })\n    );\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { HTTP_INTERCEPTORS } from '@angular/common/http';\n\nimport { AuthInterceptor } from './auth-interceptor';\n\n@NgModule({\n  imports: [],\n  declarations: [],\n  exports: []\n})\nexport class CommonModule {\n  public static forRoot(environment: any): ModuleWithProviders {\n    return {\n      ngModule: CommonModule,\n      providers: [\n        { provide: HTTP_INTERCEPTORS, useClass: AuthInterceptor, multi: true },\n        { provide: 'environment', useValue: environment }\n      ]\n    };\n  }\n}\n","import { Injectable, Inject } from '@angular/core';\nimport { NavigationEnd, Router } from '@angular/router';\n\ndeclare var gtag: Function;\n\n@Injectable()\nexport class GoogleAnalyticsService {\n  constructor(\n    public router: Router,\n    @Inject('environment') private environment\n  ) {\n    router.events.subscribe(event => {\n      try {\n        if (typeof gtag === 'function') {\n          if (event instanceof NavigationEnd) {\n            setTimeout(()=>{\n              gtag('config', this.environment.googleAnalytics.trackingId, {\n                'page_title': document.title,\n                'page_path': event.urlAfterRedirects\n              });\n            }, 100);\n          }\n        }\n      } catch (e) {\n        console.log(e);\n      }\n    });\n  }\n  public appendTrackingCode(): void {\n    try {\n      if (this.environment.googleAnalytics && this.environment.googleAnalytics.trackingId) {\n        const s1 = document.createElement('script');\n        s1.async = true;\n        s1.src = `https://www.googletagmanager.com/gtag/js?id=${this.environment.googleAnalytics.trackingId}`;\n        document.head.appendChild(s1);\n        const s2 = document.createElement('script');\n        s2.innerHTML = `\n         window.dataLayer = window.dataLayer || [];\n         function gtag(){dataLayer.push(arguments);}\n         gtag('js', new Date());\n         gtag('config', '${this.environment.googleAnalytics.trackingId}');\n       `;\n        document.head.appendChild(s2);\n      }\n    } catch (ex) {\n      console.error('Error appending google analytics');\n      console.error(ex);\n    }\n  }\n  public setEvent(action: string, category: string = null, label: string = null, value: number = null): void {\n    if (typeof gtag === 'function') {\n      gtag('event', action, {\n        event_category: category,\n        event_label: label,\n        value: value\n      });\n    }\n  }\n  public setUserId(userId: string): void {\n    if (typeof gtag === 'function') {\n      gtag('set', { 'user_id': userId });\n    }\n  }\n}\n"],"names":[],"mappings":"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"}
