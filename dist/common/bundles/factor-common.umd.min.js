!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common/http"),require("@angular/router"),require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("factor-common",["exports","@angular/core","@angular/common/http","@angular/router","rxjs","rxjs/operators"],t):t(e["factor-common"]={},e.ng.core,e.ng.common.http,e.ng.router,e.rxjs,e.rxjs.operators)}(this,function(e,n,r,o,i,c){"use strict";var t=function(){function e(){}return e.prototype["delete"]=function(e,t){t?delete t[e]:delete sessionStorage[e]},e.prototype.get=function(e,t){var n,o=t?t[e]:sessionStorage[e];if(o)try{n=JSON.parse(o)}catch(r){n=o}return n},e.prototype.set=function(e,t,n){n?n[e]=JSON.stringify(t):sessionStorage[e]=JSON.stringify(t)},e.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[]},e.ngInjectableDef=n.defineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(),a=function(){function e(e,t,n,o){this.http=e,this.injector=t,this.storageService=n,this.environment=o,this.loggedInSource=new i.BehaviorSubject(!1),this.loggedIn$=this.loggedInSource.asObservable(),this.configurationSource=new i.BehaviorSubject(!1),this.configuration$=this.configurationSource.asObservable()}return e.prototype.login=function(e){var t=this,n=Object.assign(e,{grant_type:"password",response_type:"token",client_id:this.environment.oauth.clientId,client_secret:this.environment.oauth.clientSecret});return this.http.post(this.environment.oauth.tokenUrl,n).pipe(c.tap(function(e){t.storageService.set("token",e)}))},e.prototype.logout=function(e){this.router=this.injector.get(o.Router),this.storageService["delete"]("token"),this.loggedInSource.next(!1),this.router.navigate(["/login",e?{redirect:e}:{}])},e.prototype.getConfiguration=function(){var t=this;return this.http.get(this.environment.configurationUrl).pipe(c.tap(function(e){t.loggedInSource.next(!0),t.configurationSource.next(e),t.storageService.set("lastUser",{username:e.user.username,picture:e.picture},localStorage)}))},e.prototype.getToken=function(){return this.storageService.get("token")},e.prototype.checkAuth=function(){var t=this;return!!this.getToken()&&this.getConfiguration().subscribe(function(){t.loggedInSource.next(!0)},function(e){0==e.status&&(t.router=t.injector.get(o.Router),t.router.navigateByUrl("/error/0",{skipLocationChange:!0}))})},e.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:r.HttpClient},{type:n.Injector},{type:t},{type:undefined,decorators:[{type:n.Inject,args:["environment"]}]}]},e.ngInjectableDef=n.defineInjectable({factory:function(){return new e(n.inject(r.HttpClient),n.inject(n.INJECTOR),n.inject(t),n.inject("environment"))},token:e,providedIn:"root"}),e}(),s=function(){function e(e){this.injector=e}return e.prototype.intercept=function(e,t){var n=this;this.authService=this.injector.get(a);var o=this.authService.getToken();return o&&(e=e.clone({headers:e.headers.set("Authorization",o.token_type+" "+o.access_token)})),t.handle(e).pipe(c.tap(function(e){},function(e){e instanceof r.HttpErrorResponse&&401==e.status&&n.authService.logout()}))},e.decorators=[{type:n.Injectable}],e.ctorParameters=function(){return[{type:n.Injector}]},e}(),u=function(){function t(){}return t.forRoot=function(e){return{ngModule:t,providers:[{provide:r.HTTP_INTERCEPTORS,useClass:s,multi:!0},{provide:"environment",useValue:e}]}},t.decorators=[{type:n.NgModule,args:[{imports:[],declarations:[],exports:[]}]}],t}(),g=function(){function e(e,t){var n=this;this.router=e,this.environment=t,e.events.subscribe(function(e){try{"function"==typeof gtag&&e instanceof o.NavigationEnd&&setTimeout(function(){gtag("config",n.environment.googleAnalytics.trackingId,{page_title:document.title,page_path:e.urlAfterRedirects})},100)}catch(t){console.log(t)}})}return e.prototype.appendTrackingCode=function(){try{if(this.environment.googleAnalytics&&this.environment.googleAnalytics.trackingId){var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id="+this.environment.googleAnalytics.trackingId,document.head.appendChild(e);var t=document.createElement("script");t.innerHTML="\n         window.dataLayer = window.dataLayer || [];\n         function gtag(){dataLayer.push(arguments);}\n         gtag('js', new Date());\n         gtag('config', '"+this.environment.googleAnalytics.trackingId+"');\n       ",document.head.appendChild(t)}}catch(n){console.error("Error appending google analytics"),console.error(n)}},e.prototype.setEvent=function(e,t,n,o){void 0===t&&(t=null),void 0===n&&(n=null),void 0===o&&(o=null),"function"==typeof gtag&&gtag("event",e,{event_category:t,event_label:n,value:o})},e.prototype.setUserId=function(e){"function"==typeof gtag&&gtag("set",{user_id:e})},e.decorators=[{type:n.Injectable}],e.ctorParameters=function(){return[{type:o.Router},{type:undefined,decorators:[{type:n.Inject,args:["environment"]}]}]},e}();e.AuthInterceptor=s,e.AuthService=a,e.CommonModule=u,e.GoogleAnalyticsService=g,e.StorageService=t,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=factor-common.umd.min.js.map