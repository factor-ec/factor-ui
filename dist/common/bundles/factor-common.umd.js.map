{"version":3,"file":"factor-common.umd.js.map","sources":["ng://factor-common/lib/storage.service.ts","ng://factor-common/lib/auth.service.ts","ng://factor-common/lib/auth-interceptor.ts","ng://factor-common/lib/common.module.ts","ng://factor-common/lib/google-analytics.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class StorageService {\n\n  constructor() { }\n\n  delete(key: string, storage?) {\n    if (storage) {\n      delete storage[key];\n    }else{\n      delete sessionStorage[key];\n    }\n  }\n  get(key: string, storage?) {\n    let parsedValue;\n    let value = storage ? storage[key] : sessionStorage[key];\n    if (value) {\n      try {\n        parsedValue = JSON.parse(value);\n      } catch (err) {\n        parsedValue = value;\n      }\n    }\n    return parsedValue;\n  }\n  set(key: string, value: any, storage?) {\n    if (storage) {\n      storage[key] = JSON.stringify(value);\n    } else {\n      sessionStorage[key] = JSON.stringify(value);\n    }\n  }\n}\n","import { Injectable, Injector, Inject } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { Router } from '@angular/router';\nimport { BehaviorSubject, Observable } from \"rxjs\";\nimport { tap } from 'rxjs/operators';\n\nimport { StorageService } from './storage.service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class AuthService {\n  private loggedInSource: BehaviorSubject<boolean> = new BehaviorSubject<boolean>(false);\n  loggedIn$: Observable<boolean> = this.loggedInSource.asObservable();\n  private configurationSource: BehaviorSubject<any> = new BehaviorSubject<any>(false);\n  configuration$: Observable<any> = this.configurationSource.asObservable();\n  router: Router;\n\n  constructor(\n    private http: HttpClient,\n    private injector: Injector,\n    private storageService: StorageService,\n    @Inject('environment') private environment\n  ) { }\n\n  login(formValue: { username: string, password: string }) {\n    let body: object = Object.assign(formValue, {\n      grant_type: 'password',\n      response_type: 'token',\n      client_id: this.environment.oauth.clientId,\n      client_secret: this.environment.oauth.clientSecret\n    });\n    return this.http.post(this.environment.oauth.tokenUrl, body).pipe(tap((token: any) => {\n      this.storageService.set('token', token);\n    }));\n  }\n  logout(redirect?: string) {\n    this.router = this.injector.get(Router);\n    this.storageService.delete('token');\n    this.loggedInSource.next(false);\n    this.router.navigate(['/login', redirect? {redirect:redirect} : {}]);\n  }\n  getConfiguration() {\n    return this.http.get(this.environment.configurationUrl).pipe(tap((response: any) => {\n      this.loggedInSource.next(true);\n      this.configurationSource.next(response);\n      //Save last user loggedIn\n      this.storageService.set('lastUser', {\n        username: response.user.username,\n        picture: response.picture\n      }, localStorage);\n    }));\n  }\n  getToken() {\n    return this.storageService.get('token');\n  }\n  checkAuth() {\n    if (this.getToken()) {\n      let config = this.getConfiguration().subscribe(()=>{\n        this.loggedInSource.next(true);\n      }, (error)=>{\n        if (error.status == 0) {\n          this.router = this.injector.get(Router);\n          this.router.navigateByUrl('/error/0', { skipLocationChange: true });\n        }\n      });\n      return config;\n    }else{\n      return false;\n    }\n  }\n}\n","import { Injectable, Injector } from '@angular/core';\nimport { HttpEvent, HttpInterceptor, HttpHandler, HttpRequest, HttpErrorResponse } from '@angular/common/http';\nimport { Observable } from \"rxjs\";\nimport { tap } from 'rxjs/operators';\n\nimport { AuthService } from './auth.service';\n\n@Injectable()\nexport class AuthInterceptor {\n  private authService: AuthService;\n\n  constructor(\n    private injector: Injector\n  ) { }\n\n  intercept(request: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>> {\n    this.authService = this.injector.get(AuthService);\n    let token = this.authService.getToken();\n    if (token) {\n      request = request.clone({\n        headers: request.headers.set('Authorization', `${token.token_type} ${token.access_token}`)\n      });\n    }\n    return next.handle(request).pipe(\n      tap(event => { }, err => {\n        if (err instanceof HttpErrorResponse) {\n          if (err.status == 401) {\n            this.authService.logout();\n          }\n        }\n      })\n    );\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { HTTP_INTERCEPTORS } from '@angular/common/http';\n\nimport { AuthInterceptor } from './auth-interceptor';\n\n@NgModule({\n  imports: [],\n  declarations: [],\n  exports: []\n})\nexport class CommonModule {\n  public static forRoot(environment: any): ModuleWithProviders {\n    return {\n      ngModule: CommonModule,\n      providers: [\n        { provide: HTTP_INTERCEPTORS, useClass: AuthInterceptor, multi: true },\n        { provide: 'environment', useValue: environment }\n      ]\n    };\n  }\n}\n","import { Injectable, Inject } from '@angular/core';\nimport { NavigationEnd, Router } from '@angular/router';\n\ndeclare var gtag: Function;\n\n@Injectable()\nexport class GoogleAnalyticsService {\n  constructor(\n    public router: Router,\n    @Inject('environment') private environment\n  ) {\n    router.events.subscribe(event => {\n      try {\n        if (typeof gtag === 'function') {\n          if (event instanceof NavigationEnd) {\n            setTimeout(()=>{\n              gtag('config', this.environment.googleAnalytics.trackingId, {\n                'page_title': document.title,\n                'page_path': event.urlAfterRedirects\n              });\n            }, 100);\n          }\n        }\n      } catch (e) {\n        console.log(e);\n      }\n    });\n  }\n  public appendTrackingCode(): void {\n    try {\n      if (this.environment.googleAnalytics && this.environment.googleAnalytics.trackingId) {\n        const s1 = document.createElement('script');\n        s1.async = true;\n        s1.src = `https://www.googletagmanager.com/gtag/js?id=${this.environment.googleAnalytics.trackingId}`;\n        document.head.appendChild(s1);\n        const s2 = document.createElement('script');\n        s2.innerHTML = `\n         window.dataLayer = window.dataLayer || [];\n         function gtag(){dataLayer.push(arguments);}\n         gtag('js', new Date());\n         gtag('config', '${this.environment.googleAnalytics.trackingId}');\n       `;\n        document.head.appendChild(s2);\n      }\n    } catch (ex) {\n      console.error('Error appending google analytics');\n      console.error(ex);\n    }\n  }\n  public setEvent(action: string, category: string = null, label: string = null, value: number = null): void {\n    if (typeof gtag === 'function') {\n      gtag('event', action, {\n        event_category: category,\n        event_label: label,\n        value: value\n      });\n    }\n  }\n  public setUserId(userId: string): void {\n    if (typeof gtag === 'function') {\n      gtag('set', { 'user_id': userId });\n    }\n  }\n}\n"],"names":["Injectable","BehaviorSubject","tap","Router","HttpClient","Injector","Inject","HttpErrorResponse","HTTP_INTERCEPTORS","NgModule","router","NavigationEnd"],"mappings":"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"}
