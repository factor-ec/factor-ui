!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("crypto-js"),require("@angular/router"),require("@angular/common"),require("@angular/common/http"),require("@angular/core")):"function"==typeof define&&define.amd?define("factor-utils",["exports","crypto-js","@angular/router","@angular/common","@angular/common/http","@angular/core"],e):e(t["factor-utils"]={},t.CryptoJS,t.ng.router,t.ng.common,t.ng.common.http,t.ng.core)}(this,function(t,e,o,a,i,r){"use strict";var n=function(){function t(t,e){this.platformId=t,this.configuration=e}return t.prototype["delete"]=function(t,e){if(a.isPlatformBrowser(this.platformId))if(e&&"string"!=typeof e)"object"==typeof e&&delete e[t];else switch(e){case"localStorage":delete localStorage[t];break;default:delete sessionStorage[t]}},t.prototype.get=function(t,e){var r;if(a.isPlatformBrowser(this.platformId))try{r=JSON.parse(this.getValue(t,e))}catch(o){r=this.getValue(t,e)}return r},t.prototype.getValue=function(t,e){var r;if(e&&"string"!=typeof e)"object"==typeof e&&(r=e[t]);else switch(e){case"localStorage":r=localStorage[t];break;default:r=sessionStorage[t]}return this.decrypt(r)},t.prototype.decrypt=function(t){null!==t&&t!==undefined&&""!==t&&this.configuration&&this.configuration.storage&&this.configuration.storage.encryptionSecret&&(t=e.AES.decrypt(t,this.configuration.storage.encryptionSecret).toString(e.enc.Utf8));return t},t.prototype.encrypt=function(t){return null!==t&&t!==undefined&&""!==t&&this.configuration&&this.configuration.storage&&this.configuration.storage.encryptionSecret&&(t=e.AES.encrypt(t,this.configuration.storage.encryptionSecret)),t.toString()},t.prototype.set=function(t,e,r){if(a.isPlatformBrowser(this.platformId)){var o=this.encrypt(JSON.stringify(e));if(r&&"string"!=typeof r)r[t]=o;else switch(r){case"localStorage":localStorage[t]=o;break;default:sessionStorage[t]=o}}},t.decorators=[{type:r.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:Object,decorators:[{type:r.Inject,args:[r.PLATFORM_ID]}]},{type:undefined,decorators:[{type:r.Inject,args:["FactorUtilsConfiguration"]}]}]},t.ngInjectableDef=r.defineInjectable({factory:function(){return new t(r.inject(r.PLATFORM_ID),r.inject("FactorUtilsConfiguration"))},token:t,providedIn:"root"}),t}(),c=function(){function t(t){this.router=t}return t.prototype.appendTrackingCode=function(t){try{if(t){this.trackingId=t;var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id="+t,document.head.appendChild(e);var r=document.createElement("script");r.innerHTML="\n         window.dataLayer = window.dataLayer || [];\n         function gtag(){dataLayer.push(arguments);}\n         gtag('js', new Date());\n         gtag('config', '"+t+"');\n       ",document.head.appendChild(r),this.initSubscribers()}}catch(o){console.error("Error appending google analytics"),console.error(o)}},t.prototype.initSubscribers=function(){var r=this;this.router.events.subscribe(function(t){try{"function"==typeof gtag&&t instanceof o.NavigationEnd&&r.trackingId&&setTimeout(function(){gtag("config",r.trackingId,{page_title:document.title,page_path:t.urlAfterRedirects})},100)}catch(e){console.error(e)}})},t.prototype.trackEvent=function(t,e,r,o){void 0===e&&(e=null),void 0===r&&(r=null),void 0===o&&(o=null),"function"==typeof gtag&&gtag("event",t,{event_category:e,event_label:r,value:o})},t.prototype.trackException=function(t,e){"function"==typeof gtag&&gtag("event","exception",{description:t,fatal:e})},t.prototype.setUserId=function(t){"function"==typeof gtag&&gtag("set",{user_id:t})},t.decorators=[{type:r.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:o.Router}]},t.ngInjectableDef=r.defineInjectable({factory:function(){return new t(r.inject(o.Router))},token:t,providedIn:"root"}),t}(),s=function(){function t(t){this.injector=t}return t.prototype.handleError=function(t){var e=this.injector.get(c);if(t instanceof i.HttpErrorResponse){if(navigator.onLine){var r=t.error?JSON.stringify(t.error):t.message;e.trackEvent(t.url,"Http Error",t.status+" - "+r)}}else{var o=this.injector.get(a.LocationStrategy),n=(r=t.message?t.message:t.toString(),t.stack?t.stack:t.toString());o instanceof a.PathLocationStrategy&&o.path();e.trackEvent(r,"Javascript Error",n)}throw t},t.decorators=[{type:r.Injectable}],t.ctorParameters=function(){return[{type:r.Injector}]},t}(),g=function(){function t(t){this.injector=t}return t.prototype.handleError=function(t){if(t instanceof i.HttpErrorResponse){if(navigator.onLine){var e=t.error?JSON.stringify(t.error):t.message;window.dataLayer=window.dataLayer||[],window.dataLayer.push({event:"http_error",error_message:e,error_status:t.status,error_url:t.url})}}else{var r=this.injector.get(a.LocationStrategy),o=(e=t.message?t.message:t.toString(),t.stack?t.stack:t.toString()),n=r instanceof a.PathLocationStrategy?r.path():"";window.dataLayer=window.dataLayer||[],window.dataLayer.push({event:"javascript_error",error_message:e,error_stack:o,error_url:n})}throw t},t}(),u=function(){function t(){}return t.prototype.appendTrackingCode=function(t){try{if(t){this.trackingId=t;var e=document.createElement("script");e.innerHTML="\n          (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':\n          new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],\n          j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=\n          'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);\n          })(window,document,'script','dataLayer','"+t+"');\n        ",document.head.appendChild(e);var r=document.createElement("noscript"),o=document.createElement("iframe");o.width="0",o.height="0",o.style.display="none",o.style.visibility="hidden",o.src="https://www.googletagmanager.com/ns.html?id="+t,r.appendChild(o),document.body.prepend(r)}}catch(n){console.error("Error appending google tag manager"),console.error(n)}},t.decorators=[{type:r.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[]},t.ngInjectableDef=r.defineInjectable({factory:function(){return new t},token:t,providedIn:"root"}),t}(),d=function(){function e(){}return e.forRoot=function(t){return{ngModule:e,providers:[{provide:"FactorUtilsConfiguration",useValue:t}]}},e.decorators=[{type:r.NgModule,args:[{declarations:[],imports:[],exports:[]}]}],e}();t.StorageService=n,t.GoogleAnalyticsErrorHandler=s,t.GoogleAnalyticsService=c,t.GoogleTagManagerErrorHandler=g,t.GoogleTagManagerService=u,t.UtilsModule=d,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=factor-utils.umd.min.js.map